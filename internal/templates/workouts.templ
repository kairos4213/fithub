package templates

import (
	"encoding/json"
	"fmt"
	"github.com/google/uuid"
	"github.com/kairos4213/fithub/internal/database"
	"github.com/kairos4213/fithub/internal/utils"
)

templ WorkoutsPage(workouts []database.Workout, activeTab string) {
	<section class="max-w-5xl mx-auto px-4 py-6">
		<h2 class="text-3xl font-bold mb-6">My Workouts</h2>
		@WorkoutsCreateCard()
		@WorkoutsTabs(activeTab)
		<div id="workouts-content">
			@WorkoutsCardGrid(workouts, activeTab)
		</div>
	</section>
}

templ WorkoutsCreateCard() {
	<div id="create-workout-card" class="mb-6" x-data="{ open: false }">
		<button
			x-show="!open"
			class="btn btn-primary btn-outline w-full"
			@click="open = true"
		>+ Create Workout</button>
		<div x-cloak x-show="open" class="card bg-base-100 border border-base-content/10 shadow-sm">
			<div class="card-body p-4">
				<h3 class="card-title text-base">New Workout</h3>
				<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
					<div>
						<label class="label" for="new-title"><span class="label-text">Title</span></label>
						<input id="new-title" class="input input-bordered w-full" type="text" name="title" placeholder="Workout Title" maxlength="100" required/>
					</div>
					<div>
						<label class="label" for="new-duration"><span class="label-text">Duration (min)</span></label>
						<input id="new-duration" class="input input-bordered w-full" type="number" name="duration" placeholder="Minutes" min="1" required/>
					</div>
					<div class="md:col-span-2">
						<label class="label" for="new-description"><span class="label-text">Description</span></label>
						<textarea id="new-description" class="textarea textarea-bordered w-full" name="workout-description" placeholder="Optional description" maxlength="500" rows="2"></textarea>
					</div>
					<div>
						<label class="label" for="new-planned-date"><span class="label-text">Planned Date</span></label>
						<input id="new-planned-date" class="input input-bordered w-full" type="date" name="planned-date" required/>
					</div>
				</div>
				<div class="card-actions justify-end mt-3">
					<button
						hx-post="/workouts"
						hx-include="#create-workout-card"
						hx-target="#workouts-content"
						hx-swap="innerHTML"
						hx-target-4*="body"
						class="btn btn-primary btn-sm"
						@click="open = false"
					>Create</button>
					<button class="btn btn-ghost btn-sm" @click="open = false">Cancel</button>
				</div>
			</div>
		</div>
	</div>
}

templ WorkoutsTabs(activeTab string) {
	<div class="tabs tabs-border mb-4" x-data={ fmt.Sprintf("{ tab: '%s' }", activeTab) }>
		<a
			class="tab"
			:class="tab === 'upcoming' && 'tab-active'"
			hx-get="/workouts?tab=upcoming"
			hx-target="#workouts-content"
			hx-swap="innerHTML"
			hx-push-url="/workouts?tab=upcoming"
			hx-target-4*="body"
			@click="tab = 'upcoming'"
		>Upcoming</a>
		<a
			class="tab"
			:class="tab === 'completed' && 'tab-active'"
			hx-get="/workouts?tab=completed"
			hx-target="#workouts-content"
			hx-swap="innerHTML"
			hx-push-url="/workouts?tab=completed"
			hx-target-4*="body"
			@click="tab = 'completed'"
		>Completed</a>
	</div>
}

templ WorkoutsCardGrid(workouts []database.Workout, activeTab string) {
	<div id="workouts-card-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
		if len(workouts) == 0 {
			<div class="md:col-span-2 lg:col-span-3 text-center py-12 text-base-content/50">
				if activeTab == "upcoming" {
					<p>No upcoming workouts. Create one above!</p>
				} else {
					<p>No completed workouts yet.</p>
				}
			</div>
		}
		for _, workout := range workouts {
			@WorkoutCard(workout)
		}
	</div>
}

templ WorkoutCard(workout database.Workout) {
	<div
		id={ fmt.Sprintf("workout-%v", workout.ID) }
		class="card bg-base-100 border border-base-content/10 shadow-sm"
		x-data="{ editing: false }"
	>
		<!-- View mode -->
		<div x-show="!editing" class="card-body p-4">
			<h3 class="card-title text-base">
				<a class="link link-primary link-hover" href={ templ.URL(fmt.Sprintf("/workouts/%v", workout.ID)) }>
					{ utils.TitleString(workout.Title) }
				</a>
			</h3>
			if workout.Description.Valid {
				<p class="text-sm text-base-content/60 line-clamp-2">{ workout.Description.String }</p>
			}
			<div class="flex items-center gap-4 mt-2 text-xs text-base-content/50">
				<span>~{ fmt.Sprintf("%d", workout.DurationMinutes) } min</span>
				<span>{ workout.PlannedDate.Format("Mon, Jan 02 2006") }</span>
			</div>
			if workout.DateCompleted.Valid {
				<div class="badge badge-success badge-sm mt-2">
					Completed { workout.DateCompleted.Time.Format("Jan 02 2006") }
				</div>
			}
			<div class="card-actions justify-end mt-3">
				<button class="btn btn-secondary btn-sm" @click="editing = true">Edit</button>
				<button
					class="btn btn-warning btn-sm"
					hx-delete={ templ.URL(fmt.Sprintf("/workouts/%v", workout.ID)) }
					hx-target={ fmt.Sprintf("#workout-%v", workout.ID) }
					hx-swap="delete"
					hx-target-4*="body"
				>Delete</button>
			</div>
		</div>
		<!-- Edit mode -->
		<div x-cloak x-show="editing" class="card-body p-4">
			<div class="grid grid-cols-1 gap-3">
				<div>
					<label class="label"><span class="label-text">Title</span></label>
					<input class="input input-bordered w-full" type="text" name="title" value={ workout.Title } maxlength="100" required/>
				</div>
				<div>
					<label class="label"><span class="label-text">Description</span></label>
					<textarea class="textarea textarea-bordered w-full" name="workout-description" maxlength="500" rows="2">{ workout.Description.String }</textarea>
				</div>
				<div>
					<label class="label"><span class="label-text">Duration (min)</span></label>
					<input class="input input-bordered w-full" type="number" name="duration" min="1" value={ fmt.Sprintf("%d", workout.DurationMinutes) } required/>
				</div>
				<div>
					<label class="label"><span class="label-text">Planned Date</span></label>
					<input class="input input-bordered w-full" type="date" name="planned-date" value={ workout.PlannedDate.Format("2006-01-02") }/>
				</div>
				<div>
					<label class="label"><span class="label-text">Date Completed</span></label>
					<input class="input input-bordered w-full" type="date" name="date-completed" value={ dateCompletedValue(workout) }/>
				</div>
			</div>
			<div class="card-actions justify-end mt-3">
				<button
					class="btn btn-primary btn-sm"
					hx-put={ templ.URL(fmt.Sprintf("/workouts/%v", workout.ID)) }
					hx-include={ fmt.Sprintf("#workout-%v", workout.ID) }
					hx-target={ fmt.Sprintf("#workout-%v", workout.ID) }
					hx-swap="outerHTML"
					hx-target-4*="body"
					@click="editing = false"
				>Save</button>
				<button class="btn btn-ghost btn-sm" @click="editing = false">Cancel</button>
			</div>
		</div>
	</div>
}

templ WorkoutPage(
	workout database.Workout,
	workoutExercises []database.WorkoutAndExercisesRow,
	exercises []database.Exercise,
) {
	<section class="max-w-5xl mx-auto px-4 py-6" x-data="{ editingWorkout: false }">
		<div class="mb-4">
			<a href="/workouts" class="link link-primary text-sm">&larr; Back to Workouts</a>
		</div>
		<!-- Workout header + metadata -->
		@WorkoutInfo(workout)
		@EditWorkoutInfoForm(workout)
		<!-- Quick search for adding exercises -->
		<div class="mb-6" x-data="{ searching: false }">
			<button
				x-show="!searching"
				class="btn btn-outline btn-sm"
				@click="searching = true"
			>Search For Exercises</button>
			<div x-cloak x-show="searching" class="card bg-base-100 border border-base-content/10 shadow-sm p-4">
				<div class="flex items-center justify-between mb-2">
					<h4 class="text-sm font-semibold">Add Exercise<span class="htmx-indicator loading loading-ring loading-sm ml-2"></span></h4>
					<button class="btn btn-ghost btn-xs" @click="searching = false">Close</button>
				</div>
				<input
					class="input input-bordered input-sm w-full"
					type="search"
					name="exercise-search"
					placeholder="Search by name..."
					hx-post={ templ.URL("/exercises") }
					hx-vals={ jsonVals(map[string]any{"workoutID": workout.ID.String()}) }
					hx-trigger="input changed delay:500ms, keyup[key=='Enter']"
					hx-indicator=".htmx-indicator"
					hx-target="#exercise-search-results"
				/>
				@ExerciseQuickSearchResults(exercises, workout.ID)
			</div>
		</div>
		<!-- Exercise list -->
		<h3 class="text-xl font-semibold mb-3">Exercises ({ fmt.Sprintf("%d", len(workoutExercises)) })</h3>
		@WorkoutExercisesList(workout, workoutExercises)
	</section>
}

templ WorkoutInfo(workout database.Workout) {
	<div id="workout-info" x-show="!editingWorkout" class="mb-6">
		<div class="flex items-start justify-between">
			<div>
				<h2 class="text-3xl font-bold">{ utils.TitleString(workout.Title) }</h2>
				if workout.Description.Valid {
					<p class="text-base-content/60 mt-1">{ workout.Description.String }</p>
				}
			</div>
			<div class="flex gap-2">
				<button class="btn btn-secondary btn-sm" @click="editingWorkout = !editingWorkout">Edit</button>
				<button class="btn btn-warning btn-sm" hx-delete={ templ.URL(fmt.Sprintf("/workouts/%v", workout.ID)) }>Delete</button>
			</div>
		</div>
		<div class="flex flex-wrap items-center gap-3 mt-3 text-sm text-base-content/60">
			<span>~{ fmt.Sprintf("%d", workout.DurationMinutes) } min</span>
			<span class="text-base-content/20">|</span>
			<span>{ workout.PlannedDate.Format("Mon, Jan 02 2006") }</span>
			if workout.DateCompleted.Valid {
				<span class="badge badge-success badge-sm">Completed { workout.DateCompleted.Time.Format("Jan 02 2006") }</span>
			}
		</div>
	</div>
}

templ EditWorkoutInfoForm(workout database.Workout) {
	{{
		completed := "{ completed: false }"
		dateCompleted := ""
		if workout.DateCompleted.Valid {
			completed = "{ completed: true }"
			dateCompleted = workout.DateCompleted.Time.Format("2006-01-02")
		}
	}}
	<form x-cloak x-show="editingWorkout" x-data={ completed }>
		<fieldset class="fieldset bg-base-100 border-base-300 rounded-box w-auto border p-4">
			<legend class="fieldset-legend">Edit Workout Details</legend>
			<label class="label">Workout Title</label>
			<input
				class="input input-ghost text-center border-secondary"
				type="text"
				name="title"
				placeholder="Enter a workout title"
				value={ fmt.Sprintf("%v", workout.Title) }
				required
			/>
			<label class="label">Workout Description</label>
			<textarea
				class="textarea textarea-md text-center border-secondary"
				name="workout-description"
				placeholder="Enter a description"
			>{ workout.Description.String }</textarea>
			<label class="label">Workout Duration</label>
			<input
				class="input validator border-secondary"
				type="number"
				name="duration"
				placeholder="Planned Duration in Minutes"
				min="0"
				value={ workout.DurationMinutes }
				required
			/>
			<label class="label">Planned Date</label>
			<input
				class="input border-secondary"
				type="date"
				name="planned-date"
				value={ workout.PlannedDate.Format("2006-01-02") }
			/>
			if workout.DateCompleted.Valid {
				<label class="label">
					Completed
					<input type="checkbox" @click="completed = ! completed" checked="checked" class="checkbox checkbox-secondary"/>
				</label>
			} else {
				<label class="label">
					Completed
					<input type="checkbox" @click="completed = ! completed" class="checkbox checkbox-secondary"/>
				</label>
			}
			<template x-if="completed">
				<input class="input border-secondary" type="date" name="date-completed" value={ dateCompleted }/>
			</template>
			<button
				type="submit"
				hx-put={ templ.URL(fmt.Sprintf("/workouts/%v", workout.ID)) }
				hx-target="#workout-info"
				class="btn btn-primary"
				@click="editingWorkout = !editingWorkout"
			>Submit</button>
			<button class="btn btn-warning" @click="editingWorkout = !editingWorkout">Cancel</button>
		</fieldset>
	</form>
}

templ WorkoutExercisesList(workout database.Workout, workoutExercises []database.WorkoutAndExercisesRow) {
	<div
		id="workout-exercises"
		class="space-y-3"
		hx-put={ fmt.Sprintf("/workouts/%v/sort", workout.ID) }
		hx-trigger="end"
		hx-include=".exercise-order"
		hx-target-4*="body"
		hx-target-5*="body"
		x-sort="sortExercises()"
	>
		for _, workoutExercise := range workoutExercises {
			@WorkoutExerciseCard(workoutExercise)
		}
	</div>
	@WorkoutExerciseAddCard(workout)
}

templ WorkoutExerciseCard(workoutExercise database.WorkoutAndExercisesRow) {
	{{
		plannedSets := workoutExercise.WorkoutsExercise.SetsPlanned
		plannedReps, _ := json.Marshal(workoutExercise.WorkoutsExercise.RepsPerSetPlanned)
		plannedWeights, _ := json.Marshal(workoutExercise.WorkoutsExercise.WeightsPlannedLbs)
		completedSets := workoutExercise.WorkoutsExercise.SetsCompleted
		completedReps, _ := json.Marshal(workoutExercise.WorkoutsExercise.RepsPerSetCompleted)
		completedWeights, _ := json.Marshal(workoutExercise.WorkoutsExercise.WeightsCompletedLbs)
	}}
	<div
		id={ fmt.Sprintf("workout-exercise-%v", workoutExercise.WorkoutsExercise.ID) }
		class="card bg-base-100 border border-base-content/10 p-4"
		x-sort:item={ fmt.Sprintf("%v", workoutExercise.WorkoutsExercise.SortOrder) }
		x-data={ fmt.Sprintf("workoutExerciseRow(%v, %v, %v, %v, %v, %v)",
			plannedSets, string(plannedReps), string(plannedWeights),
			completedSets, string(completedReps), string(completedWeights)) }
		x-init="updateArrays('plannedSets', plannedSets)"
	>
		<!-- Header: drag handle + name + badge + actions -->
		<div class="flex items-center justify-between mb-2">
			<div class="flex items-center gap-2">
				<span x-sort:handle class="hover:cursor-grab active:cursor-grabbing">
					<input class="exercise-order hidden" name="sort-order[]" value={ fmt.Sprintf("%v", workoutExercise.WorkoutsExercise.ID) }/>
					<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
						<circle cx="9" cy="6" r="1.5"></circle>
						<circle cx="9" cy="12" r="1.5"></circle>
						<circle cx="9" cy="18" r="1.5"></circle>
						<circle cx="15" cy="6" r="1.5"></circle>
						<circle cx="15" cy="12" r="1.5"></circle>
						<circle cx="15" cy="18" r="1.5"></circle>
					</svg>
				</span>
				<span class="font-medium">{ utils.TitleString(workoutExercise.Exercise.Name) }</span>
				if workoutExercise.Exercise.PrimaryMuscleGroup.Valid {
					<span class="badge badge-outline badge-sm">{ utils.TitleString(workoutExercise.Exercise.PrimaryMuscleGroup.String) }</span>
				}
			</div>
			<div x-show="!editingExercise" class="flex gap-1">
				<button class="btn btn-secondary btn-xs" @click="editingExercise = true">Edit</button>
				<button
					class="btn btn-warning btn-xs"
					hx-delete={ templ.URL(fmt.Sprintf("/workouts/%v/%v",
						workoutExercise.WorkoutsExercise.WorkoutID,
						workoutExercise.WorkoutsExercise.ID)) }
					hx-target={ fmt.Sprintf("#workout-exercise-%v", workoutExercise.WorkoutsExercise.ID) }
					hx-swap="delete"
					hx-target-4*="body"
					hx-target-5*="body"
				>Delete</button>
			</div>
		</div>
		<!-- View mode -->
		<div x-show="!editingExercise">
			@exerciseDataView(workoutExercise)
		</div>
		<!-- Edit mode -->
		<div x-cloak x-show="editingExercise">
			<input value={ fmt.Sprintf("%v", workoutExercise.Exercise.ID) } name="exercise" class="hidden"/>
			@exerciseDataEdit()
			<div class="flex justify-end gap-2 mt-3">
				<button
					class="btn btn-primary btn-sm"
					hx-put={ templ.URL(fmt.Sprintf("/workouts/%v/%v",
						workoutExercise.WorkoutsExercise.WorkoutID,
						workoutExercise.WorkoutsExercise.ID)) }
					hx-include={ fmt.Sprintf("#workout-exercise-%v", workoutExercise.WorkoutsExercise.ID) }
					hx-target={ fmt.Sprintf("#workout-exercise-%v", workoutExercise.WorkoutsExercise.ID) }
					hx-swap="outerHTML"
					hx-target-4*="body"
					hx-target-5*="body"
					@click="editingExercise = false"
				>Save</button>
				<button class="btn btn-ghost btn-sm" @click="editingExercise = false">Cancel</button>
			</div>
		</div>
	</div>
}

templ exerciseDataView(we database.WorkoutAndExercisesRow) {
	<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
		<!-- Planned -->
		<div>
			<h4 class="text-xs font-semibold text-base-content/50 mb-1">
				Planned ({ fmt.Sprintf("%d", we.WorkoutsExercise.SetsPlanned) } sets)
			</h4>
			<table class="table table-xs w-full">
				<thead>
					<tr class="text-xs text-base-content/50">
						<th>Set</th>
						<th>Reps</th>
						<th>Weight (lbs)</th>
					</tr>
				</thead>
				<tbody>
					for i, reps := range we.WorkoutsExercise.RepsPerSetPlanned {
						<tr>
							<td class="font-mono text-xs">{ fmt.Sprintf("%d", i+1) }</td>
							<td>{ fmt.Sprintf("%d", reps) }</td>
							<td>
								if i < len(we.WorkoutsExercise.WeightsPlannedLbs) {
									{ fmt.Sprintf("%d", we.WorkoutsExercise.WeightsPlannedLbs[i]) }
								} else {
									0
								}
							</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
		<!-- Completed -->
		<div>
			<h4 class="text-xs font-semibold text-base-content/50 mb-1">
				Completed ({ fmt.Sprintf("%d", we.WorkoutsExercise.SetsCompleted) } sets)
			</h4>
			if we.WorkoutsExercise.SetsCompleted > 0 {
				<table class="table table-xs w-full">
					<thead>
						<tr class="text-xs text-base-content/50">
							<th>Set</th>
							<th>Reps</th>
							<th>Weight (lbs)</th>
						</tr>
					</thead>
					<tbody>
						for i, reps := range we.WorkoutsExercise.RepsPerSetCompleted {
							<tr>
								<td class="font-mono text-xs">{ fmt.Sprintf("%d", i+1) }</td>
								<td>{ fmt.Sprintf("%d", reps) }</td>
								<td>
									if i < len(we.WorkoutsExercise.WeightsCompletedLbs) {
										{ fmt.Sprintf("%d", we.WorkoutsExercise.WeightsCompletedLbs[i]) }
									} else {
										0
									}
								</td>
							</tr>
						}
					</tbody>
				</table>
			} else {
				<p class="text-xs text-base-content/40 italic">Not yet completed</p>
			}
		</div>
	</div>
}

templ exerciseDataEdit() {
	<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
		<!-- Planned edit -->
		<div>
			<label class="label py-0"><span class="label-text text-xs">Planned Sets</span></label>
			<input
				class="input input-bordered input-sm w-24"
				type="number"
				name="planned-sets"
				min="1"
				x-model.number="plannedSets"
				@input="updateArrays('plannedSets', plannedSets)"
				required
			/>
			<table class="table table-xs w-full mt-2">
				<thead>
					<tr class="text-xs text-base-content/50">
						<th>Set</th>
						<th>Reps</th>
						<th>Weight (lbs)</th>
					</tr>
				</thead>
				<tbody>
					<template x-for="(r, i) in plannedReps" :key="i">
						<tr>
							<td class="font-mono text-xs" x-text="i+1"></td>
							<td>
								<input
									class="input input-bordered input-xs w-20"
									type="number"
									name="planned-reps[]"
									min="1"
									x-model="plannedReps[i]"
									required
								/>
							</td>
							<td>
								<input
									class="input input-bordered input-xs w-20"
									type="number"
									name="planned-weights[]"
									min="0"
									x-model="plannedWeights[i]"
									required
								/>
							</td>
						</tr>
					</template>
				</tbody>
			</table>
		</div>
		<!-- Completed edit -->
		<div>
			<label class="label py-0"><span class="label-text text-xs">Completed Sets</span></label>
			<input
				class="input input-bordered input-sm w-24"
				type="number"
				name="completed-sets"
				min="0"
				x-model.number="completedSets"
				@input="updateArrays('completedSets', completedSets)"
				required
			/>
			<table class="table table-xs w-full mt-2">
				<thead>
					<tr class="text-xs text-base-content/50">
						<th>Set</th>
						<th>Reps</th>
						<th>Weight (lbs)</th>
					</tr>
				</thead>
				<tbody>
					<template x-for="(r, i) in completedReps" :key="i">
						<tr>
							<td class="font-mono text-xs" x-text="i+1"></td>
							<td>
								<input
									class="input input-bordered input-xs w-20"
									type="number"
									name="completed-reps[]"
									min="0"
									x-model="completedReps[i]"
									required
								/>
							</td>
							<td>
								<input
									class="input input-bordered input-xs w-20"
									type="number"
									name="completed-weights[]"
									min="0"
									x-model="completedWeights[i]"
									required
								/>
							</td>
						</tr>
					</template>
				</tbody>
			</table>
		</div>
	</div>
}

templ WorkoutExerciseAddCard(workout database.Workout) {
	<div id="add-exercise-card" class="mt-3" x-data="workoutExerciseFooter()" x-init="updateArrays(plannedSets)">
		<button x-show="!open" class="btn btn-primary btn-outline w-full" @click="open = true">+ Add Exercise</button>
		<div x-cloak x-show="open" class="card bg-base-100 border border-base-content/10 p-4">
			<h4 class="font-medium mb-2">Add Exercise</h4>
			<input class="input input-bordered w-full mb-2" type="text" name="exercise-name" placeholder="Exercise Name" required/>
			<label class="label py-0"><span class="label-text text-xs">Planned Sets</span></label>
			<input
				class="input input-bordered input-sm w-24 mb-2"
				type="number"
				name="planned-sets"
				min="1"
				x-model.number="plannedSets"
				@input="updateArrays(plannedSets)"
				required
			/>
			<table class="table table-md w-full">
				<thead>
					<tr class="text-xs text-base-content/50">
						<th>Set</th>
						<th>Reps</th>
						<th>Weight (lbs)</th>
					</tr>
				</thead>
				<tbody>
					<template x-for="(r, i) in plannedReps" :key="i">
						<tr>
							<td class="font-mono text-xs" x-text="i+1"></td>
							<td>
								<input
									class="input input-bordered input-xs w-20"
									type="number"
									name="planned-reps[]"
									min="1"
									x-model="plannedReps[i]"
									required
								/>
							</td>
							<td>
								<input
									class="input input-bordered input-xs w-20"
									type="number"
									name="planned-weights[]"
									min="0"
									x-model="plannedWeights[i]"
									required
								/>
							</td>
						</tr>
					</template>
				</tbody>
			</table>
			<div class="flex justify-end gap-2 mt-3">
				<button
					class="btn btn-primary btn-sm"
					hx-post={ templ.URL(fmt.Sprintf("/workouts/%v", workout.ID)) }
					hx-include="#add-exercise-card"
					hx-target="#workout-exercises"
					hx-swap="beforeend"
					@click="open = false"
				>Add</button>
				<button
					class="btn btn-ghost btn-sm"
					@click="open = false; plannedSets = 1; plannedReps = [1]; plannedWeights = [0]; updateArrays(plannedSets)"
				>Cancel</button>
			</div>
		</div>
	</div>
}

templ ExerciseQuickSearchResults(exercises []database.Exercise, workout uuid.UUID) {
	<div id="exercise-search-results" class="overflow-x-auto">
		for _, exercise := range exercises {
			<details class="collapse collapse-plus bg-base-100 border border-base-300">
				<summary class="collapse-title font-semibold">{ exercise.Name }</summary>
				<div class="flex flex-col collapse-content space-y-2">
					<div class="join join-vertical md:join-horizontal">
						<span
							class="badge badge-sm badge-primary join-item
            md:rounded-l-full w-52"
						>
							Primary: { 
          utils.TitleString(exercise.PrimaryMuscleGroup.String) }
						</span>
						<span
							class="badge badge-sm badge-secondary join-item
            md:rounded-r-full w-52"
						>
							Secondary: { 
          utils.TitleString(exercise.SecondaryMuscleGroup.String) }
						</span>
					</div>
					<div class="flex flex-col justify-between bg-base-200 p-4 rounded-2xl">
						<div class="overflow-y-auto">
							<p class="text-sm mt-0 pt-0">Description:</p>
							<p class="text-lg">{ exercise.Description.String }</p>
						</div>
						<a href={ templ.URL(fmt.Sprintf("/exercises/%v", exercise.ID)) } class="link link-primary text-sm self-end">
							See
							More
						</a>
					</div>
					<button
						hx-post={ templ.URL(fmt.Sprintf("/workouts/%v", workout)) }
						hx-vals={ jsonVals(map[string]any{
						"exercise-name":     exercise.Name,
						"planned-sets":      "1",
						"planned-reps[]":    []string{"1"},
						"planned-weights[]": []string{"0"},
					}) }
						hx-target="#workout-exercises"
						hx-swap="beforeend"
						class="btn btn-outline btn-primary btn-ghost self-end"
					>Add Exercise</button>
				</div>
			</details>
		}
	</div>
}
